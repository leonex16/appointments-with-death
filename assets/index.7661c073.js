var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,l=(t,a,n)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n;import{R as i,C as s,D as c,I as m,B as p,i as u,k as d,A as h,O as g,M as b,u as f,_ as E,b as v,d as y,a as N,m as w,r as A,T as S,c as D,e as x,f as I}from"./vendor.e24a7373.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const O=e=>{const{month:t,setMonth:a}=e;return i.createElement(s,{inline:!0,value:t,onChange:e=>a(e.value),view:"month",yearRange:"2020:2025",showButtonBar:!0,todayButtonClassName:"calendar-month-today-button",clearButtonClassName:"calendar-month-clear-button"})},T=e=>{const{detail:t,summary:a}=e;return i.createElement("div",null,i.createElement("span",{className:"p-toast-summary"},a),i.createElement("div",{className:"p-toast-detail"},t))},k=e=>{const{isDialogVisible:t,setIsDialogVisible:a,onSubmit:n,dateAppointment:r,loading:o}=e;return i.createElement(c,{className:"dialog-form-container",header:"Personal Information",visible:t,onHide:()=>a(!1)},i.createElement("form",{className:"form-container p-fluid",onSubmit:n},i.createElement("div",{className:"form-group p-inputgroup"},i.createElement("span",{className:" p-float-label"},i.createElement(m,{id:"name",name:"name",type:"text"}),i.createElement("label",{htmlFor:"name"},"Name")),i.createElement("span",{className:"p-inputgroup-addon p-inputgroup-addon--custom"},i.createElement("i",{className:"pi pi-user"}))),i.createElement("div",{className:"form-group p-inputgroup"},i.createElement("span",{className:" p-float-label"},i.createElement(m,{id:"phoneNumber",name:"phoneNumber",type:"text"}),i.createElement("label",{htmlFor:"phoneNumber"},"Phone Number")),i.createElement("span",{className:"p-inputgroup-addon p-inputgroup-addon--custom"},i.createElement("i",{className:"pi pi-phone"}))),i.createElement("div",{className:"form-group p-inputgroup"},i.createElement("span",{className:" p-float-label"},i.createElement(m,{id:"email",name:"email",type:"text"}),i.createElement("label",{htmlFor:"email"},"Email")),i.createElement("span",{className:"p-inputgroup-addon p-inputgroup-addon--custom"},i.createElement("i",{className:"pi pi-send"}))),i.createElement("span",{className:"form-group p-float-label"},i.createElement(s,{id:"appointment",name:"appointment",value:r,showIcon:!0,showTime:!0,disabled:!0}),i.createElement("label",{htmlFor:"appointment"},"Appointment")),i.createElement("span",{className:"form-group "},i.createElement(p,{type:"submit",label:"Submit",icon:"pi pi-check",loading:o,style:{fontWeight:"bold"}}))))};u({apiKey:"AIzaSyAJO2b8NZXcfplbM1JIARSn22FZ7ukZcQA",authDomain:"appointment-with-death.firebaseapp.com",projectId:"appointment-with-death",storageBucket:"appointment-with-death.appspot.com",messagingSenderId:"405697384525",appId:"1:405697384525:web:008fc606a7ffbe624d8c04"});const M=d(),P=h(M,"/users");function j(e){const{dateAppointment:t}=e.data();return{dateAppointment:new Date(1e3*t.seconds)}}const C={post:async e=>(await E(P,e)).id,getByEmail:async e=>{const i=g(P,b("email","==",e)),s=await f(i);var c,m;if(0!==s.size&&(s.size>=2&&console.error("RETURN TOO MANY USERS"),1===s.size)){return{user:(c=((e,t)=>{for(var a in t||(t={}))r.call(t,a)&&l(e,a,t[a]);if(n)for(var a of n(t))o.call(t,a)&&l(e,a,t[a]);return e})({},s.docs[0].data()),m={id:s.docs[0].id},t(c,a(m))),userRef:s.docs[0]}}},addAppointment:async(e,t,a)=>{const n=v(M,"users",e),{name:r,phoneNumber:o}=t;await y(n,{name:r,phoneNumber:o,appointments:N(a)})}},F=h(M,"/appointments"),R={getAll:async()=>{const e=await f(F),t=[];return e.forEach((e=>t.push(j(e)))),t},getAllStream:e=>w(F,e),post:async e=>{const{dateAppointment:t,email:a,name:n,phoneNumber:r}=e,o=await E(F,{dateAppointment:t}),l=await C.getByEmail(a);void 0===l?await C.post({appointments:[o],email:a,name:n,phoneNumber:r}):await C.addAppointment(l.user.id,{name:n,phoneNumber:r},o)}},B=e=>{const{date:t}=e,a=A.exports.useRef(null),[n,r]=A.exports.useState(!1),[o,l]=A.exports.useState(!1);return i.createElement(i.Fragment,null,i.createElement(k,{isDialogVisible:n,setIsDialogVisible:r,onSubmit:e=>{var t,n,o,s;e.preventDefault(),l(!0);const{name:c,phoneNumber:m,email:p,appointment:u}=e.target,d={name:null==(t=null==c?void 0:c.value)?void 0:t.trim(),phoneNumber:null==(n=null==m?void 0:m.value)?void 0:n.trim(),email:null==(o=null==p?void 0:p.value)?void 0:o.trim(),dateAppointment:null==(s=null==u?void 0:u.value)?void 0:s.trim()},h={contentClassName:"",severity:"warn",life:6e3,content:i.createElement(T,{summary:"Scheduled Appointment",detail:"Are you ready to dance with Death? ðŸ˜±"})};if(!1===(e=>{if(isNaN(e.phoneNumber))return!1;for(const t in e)if(void 0===e[t]||""===e[t])return!1;return!0})(d))return h.severity="error",h.content=i.createElement(T,{summary:"Form Invalid",detail:"Check the information entered, please ðŸ¥ºðŸ‘‰ðŸ‘ˆ"}),null!==a.current&&a.current.show(h),void l(!1);const g=(e=>{var t;return{appointments:null!=(t=e.appointments)?t:[],dateAppointment:new Date(e.dateAppointment),email:e.email,name:e.name,phoneNumber:+e.phoneNumber}})(d);R.post(g).then((()=>{localStorage.setItem("lastScheduling",(new Date).getTime().toString()),r(!1),null!==a.current&&a.current.show(h),l(!1)})).catch((e=>{h.severity="error",h.content=i.createElement(T,{summary:"Ops!",detail:"Sorry, we are having trouble ðŸ˜¥. Try again later ðŸ¥ºðŸ‘‰ðŸ‘ˆ"}),console.error("SCHEDULE_APPOINTMENT: "+e),null!==a.current&&a.current.show(h),l(!1)}))},dateAppointment:t,loading:o}),i.createElement(S,{ref:a}),i.createElement(p,{className:"p-button-outlined",label:"Schedule",icon:"pi pi-calendar",iconPos:"left",onClick:()=>{const e=localStorage.getItem("lastScheduling");if(null===e||((e,t)=>{const a=e.getTime();return(t.getTime()-a)/36e5})(new Date(+e),new Date)>1)return r(!0);const t={contentClassName:"",severity:"error",life:6e3,content:i.createElement(T,{summary:"Scheduling blocked",detail:"Sorry, but you scheduled an appointment less than an hour ago"})};a.current.show(t)}}))},$=(e,t)=>new Intl.DateTimeFormat("en-US",t).format(e),H=e=>{const{appointmentsAvailable:t,month:a}=e,[n,r]=A.exports.useState([]),[o,l]=A.exports.useState(!0);return A.exports.useEffect((()=>{t.length>0&&l(!1)}),[t]),i.createElement(D,{scrollable:!0,dataKey:"id",scrollHeight:"calc(75vh - 80px)",value:t,loading:o,expandedRows:n,rowExpansionTemplate:e=>i.createElement(D,{scrollable:!0,scrollHeight:"150%",value:e.hoursAvailable},i.createElement(x,{field:"hoursAvailable",header:"Hours available",body:e=>e.slice(0,5)}),i.createElement(x,{field:"scheduleAppointment",header:"Schedule appointment",body:t=>i.createElement(B,{date:new Date(`${e.date} ${t}`)})})),onRowToggle:e=>r(e.data)},i.createElement(x,{expander:!0,style:{width:"3rem"}}),i.createElement(x,{style:{width:"3rem"},field:"id",header:"#"}),i.createElement(x,{field:"date",header:`Date (${$(new Date(a),{month:"long"})})`,body:({date:e})=>(e=>$(new Date(e),{weekday:"long",day:"2-digit"}))(e)}),i.createElement(x,{field:"quantityAvailable",header:"Quantity available",body:e=>e.hoursAvailable.length}))},L=e=>{const t=e.getFullYear(),a=e.getMonth();return(e=>{const t=[],a=e.getDate(),n=(e.getMonth()+1).toString().padStart(2,"0"),r=e.getFullYear().toString();for(let o=0;o<a;o++){const e=`${r}/${n}/${(o+1).toString().padStart(2,"0")}`;0!==new Date(e).getDay()&&6!==new Date(e).getDay()&&t.push(e)}return t})(new Date(t,a+1,0))},z=e=>{const t=[];for(let a=0;a<24;a++)!0===e.includes(a)||a<9||a>18||t.push(`${a.toString().padStart(2,"0")}:00:00`);return t};function U(){const[e,t]=A.exports.useState(void 0),[a,n]=A.exports.useState([]),[r,o]=A.exports.useState([]),l=R,s=(e,t)=>{const a=((e,t)=>e.filter((e=>e.dateAppointment.getMonth()===t.getMonth())))(e,t),n=L(t),r=(e=>e.reduce(((e,t)=>{const a=t.dateAppointment.toLocaleDateString("en-ZA").replaceAll("/",""),n=e.findIndex((e=>!!e[a]));return-1===n?e.push({[a]:[t]}):e[n][a].push(t),e}),[]))(a),o=(l=r,n.map((e=>{const t=e.replaceAll("/",""),a=Object.values(l);for(let n=0;n<a.length;n++){const r=a[n][t];if(void 0!==r){const t=r.map((e=>e.dateAppointment.getHours()));return{date:e,hoursAvailable:z(t)}}}return{date:e,hoursAvailable:z([])}})));var l;return o.filter((e=>0!==e.hoursAvailable.length)).map(((e,t)=>({id:t+1,date:e.date.slice(0,10),hoursAvailable:e.hoursAvailable})))},c=t=>{if(void 0===e)return;const a=[];t.forEach((e=>a.push(j(e)))),o(s(a,e))};return A.exports.useEffect((()=>{(async()=>{await(async()=>{n(await l.getAll()),void 0!==e&&o(s(a,e))})()})();const t=l.getAllStream(c);return()=>t()}),[e]),i.createElement("article",{role:"main",className:"p-grid p-justify-center p-align-center"},i.createElement("header",{className:"header-container p-col-12 p-text-center"},void 0!==e&&i.createElement(p,{className:"header-container__btn-back p-button-rounded p-button-outlined",icon:"pi pi-arrow-left",onClick:()=>{o([]),n([]),t(void 0)}}),i.createElement("h1",{style:{color:"var(--text-color)"}},"ðŸ’€ðŸ•ºðŸ’€ Dancing with Death ðŸ’€ðŸ’ƒðŸ’€")),void 0===e?i.createElement("section",{className:"calendar-month-container p-col-fixed p-shadow-10"},i.createElement(O,{month:e,setMonth:t})):i.createElement("section",{className:"table-appointments-container p-col-12 p-shadow-10"},i.createElement(H,{appointmentsAvailable:r,month:e})))}I.render(i.createElement(i.StrictMode,null,i.createElement(U,null)),document.getElementById("root"));
